---
- name: Get bash config file
  ansible.builtin.stat:
    path: "{{ bash_history_bash_config_file }}"
  register: bash_config_file

- name: Ensure bash config file exists
  ansible.builtin.fail:
    msg: "Bash config file {{ bash_history_bash_config_file }} does not exist. Please ensure the passed path via bash_history_bash_config_file variable is correct."
  when: not bash_config_file.stat.exists

- name: Add custom configurations to .bashrc
  ansible.builtin.blockinfile:
    path: "{{ bash_history_bash_config_file }}"
    block: "{{ lookup('template', 'templates/history_config.sh.j2') }}"
    marker: "# {mark} GENERATED BY ANSIBLE BASH_HISTORY ROLE"
    backup: true
